"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\nconst MAX_REDIRECTS = 5;\nconst rolePaths = {\n    Admin: [\n        \"/admin/dashBoard\",\n        \"/admin/addUser\",\n        \"/admin/editUser/[id]\"\n    ],\n    Instructor: [\n        \"/instructor/dashBoard\"\n    ],\n    ExamOfficer: [\n        \"/exam-officer/profile\"\n    ],\n    TechUnit: [\n        \"/tech/dashBoard\"\n    ]\n};\nasync function middleware(request) {\n    console.log(\"Middleware called for path:\", request.nextUrl.pathname);\n    const redirectCount = parseInt(request.headers.get(\"x-redirect-count\") || \"0\");\n    console.log(\"Current redirect count:\", redirectCount);\n    if (redirectCount >= MAX_REDIRECTS) {\n        console.log(\"Max redirects reached, going to error page\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/error\", request.url));\n    }\n    const userEmail = request.cookies.get(\"userEmail\")?.value;\n    const userRole = request.cookies.get(\"role\")?.value;\n    console.log(\"User email:\", userEmail, \"User role:\", userRole);\n    // ไม่ต้องเช็คการ redirect สำหรับหน้า sign-in และ error\n    if (request.nextUrl.pathname === \"/sign-in\" || request.nextUrl.pathname === \"/error\") {\n        console.log(\"On sign-in or error page, no redirect\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    if (!userEmail) {\n        console.log(\"No user email, redirecting to sign-in\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/sign-in\", request.url));\n    }\n    if (request.nextUrl.pathname.startsWith(\"/protected\")) {\n        const redirectUrl = getRoleBasedRedirect(userRole, request.url);\n        if (redirectUrl) {\n            console.log(\"Redirecting to role-based URL:\", redirectUrl.toString());\n            const newResponse = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(redirectUrl);\n            newResponse.headers.set(\"x-redirect-count\", (redirectCount + 1).toString());\n            return newResponse;\n        }\n    }\n    // Check if the current path is valid for the user's role\n    const allowedPaths = rolePaths[userRole];\n    if (allowedPaths && !allowedPaths.includes(request.nextUrl.pathname)) {\n        console.log(`User role ${userRole} tried to access a restricted path, redirecting to default role path`);\n        const defaultRedirectUrl = new URL(allowedPaths[0], request.url);\n        const newResponse = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(defaultRedirectUrl);\n        newResponse.headers.set(\"x-redirect-count\", (redirectCount + 1).toString());\n        return newResponse;\n    }\n    console.log(\"No redirect needed, proceeding to requested page\");\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\nfunction getRoleBasedRedirect(role, baseUrl) {\n    switch(role){\n        case \"Admin\":\n            return new URL(\"/admin/dashBoard\", baseUrl);\n        case \"Instructor\":\n            return new URL(\"/instructor/dashBoard\", baseUrl);\n        case \"ExamOfficer\":\n            return new URL(\"/exam-officer/profile\", baseUrl);\n        case \"TechUnit\":\n            return new URL(\"/tech/dashBoard\", baseUrl);\n        default:\n            return null;\n    }\n}\nconst config = {\n    matcher: [\n        \"/((?!api|_next/static|_next/image|favicon.ico|assets).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUs7WUFDSCxPQUFPLElBQUlqQixJQUFJLG1CQUFtQmlCO1FBQ3BDO1lBQ0UsT0FBTztJQUNYO0FBQ0Y7QUFFTyxNQUFNQyxTQUFTO0lBQ3BCQyxTQUFTO1FBQUM7S0FBMkQ7QUFDdkUsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9taWRkbGV3YXJlLnRzPzQyMmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5cclxuY29uc3QgTUFYX1JFRElSRUNUUyA9IDU7XHJcbmNvbnN0IHJvbGVQYXRocyA9IHtcclxuICBBZG1pbjogWycvYWRtaW4vZGFzaEJvYXJkJywnL2FkbWluL2FkZFVzZXInLCcvYWRtaW4vZWRpdFVzZXIvW2lkXSddLFxyXG4gIEluc3RydWN0b3I6IFsnL2luc3RydWN0b3IvZGFzaEJvYXJkJ10sXHJcbiAgRXhhbU9mZmljZXI6IFsnL2V4YW0tb2ZmaWNlci9wcm9maWxlJ10sXHJcbiAgVGVjaFVuaXQ6IFsnL3RlY2gvZGFzaEJvYXJkJ10sXHJcbn07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIGNvbnNvbGUubG9nKCdNaWRkbGV3YXJlIGNhbGxlZCBmb3IgcGF0aDonLCByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUpO1xyXG5cclxuICBjb25zdCByZWRpcmVjdENvdW50ID0gcGFyc2VJbnQocmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWRpcmVjdC1jb3VudCcpIHx8ICcwJyk7XHJcbiAgY29uc29sZS5sb2coJ0N1cnJlbnQgcmVkaXJlY3QgY291bnQ6JywgcmVkaXJlY3RDb3VudCk7XHJcblxyXG4gIGlmIChyZWRpcmVjdENvdW50ID49IE1BWF9SRURJUkVDVFMpIHtcclxuICAgIGNvbnNvbGUubG9nKCdNYXggcmVkaXJlY3RzIHJlYWNoZWQsIGdvaW5nIHRvIGVycm9yIHBhZ2UnKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9lcnJvclwiLCByZXF1ZXN0LnVybCkpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdXNlckVtYWlsID0gcmVxdWVzdC5jb29raWVzLmdldCgndXNlckVtYWlsJyk/LnZhbHVlO1xyXG4gIGNvbnN0IHVzZXJSb2xlID0gcmVxdWVzdC5jb29raWVzLmdldCgncm9sZScpPy52YWx1ZTtcclxuICBjb25zb2xlLmxvZygnVXNlciBlbWFpbDonLCB1c2VyRW1haWwsICdVc2VyIHJvbGU6JywgdXNlclJvbGUpO1xyXG5cclxuICAvLyDguYTguKHguYjguJXguYnguK3guIfguYDguIrguYfguITguIHguLLguKMgcmVkaXJlY3Qg4Liq4Liz4Lir4Lij4Lix4Lia4Lir4LiZ4LmJ4LiyIHNpZ24taW4g4LmB4Lil4LiwIGVycm9yXHJcbiAgaWYgKHJlcXVlc3QubmV4dFVybC5wYXRobmFtZSA9PT0gJy9zaWduLWluJyB8fCByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUgPT09ICcvZXJyb3InKSB7XHJcbiAgICBjb25zb2xlLmxvZygnT24gc2lnbi1pbiBvciBlcnJvciBwYWdlLCBubyByZWRpcmVjdCcpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBpZiAoIXVzZXJFbWFpbCkge1xyXG4gICAgY29uc29sZS5sb2coJ05vIHVzZXIgZW1haWwsIHJlZGlyZWN0aW5nIHRvIHNpZ24taW4nKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9zaWduLWluXCIsIHJlcXVlc3QudXJsKSk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9wcm90ZWN0ZWQnKSkge1xyXG4gICAgY29uc3QgcmVkaXJlY3RVcmwgPSBnZXRSb2xlQmFzZWRSZWRpcmVjdCh1c2VyUm9sZSwgcmVxdWVzdC51cmwpO1xyXG4gICAgaWYgKHJlZGlyZWN0VXJsKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSZWRpcmVjdGluZyB0byByb2xlLWJhc2VkIFVSTDonLCByZWRpcmVjdFVybC50b1N0cmluZygpKTtcclxuICAgICAgY29uc3QgbmV3UmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QocmVkaXJlY3RVcmwpO1xyXG4gICAgICBuZXdSZXNwb25zZS5oZWFkZXJzLnNldCgneC1yZWRpcmVjdC1jb3VudCcsIChyZWRpcmVjdENvdW50ICsgMSkudG9TdHJpbmcoKSk7XHJcbiAgICAgIHJldHVybiBuZXdSZXNwb25zZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IHBhdGggaXMgdmFsaWQgZm9yIHRoZSB1c2VyJ3Mgcm9sZVxyXG4gIGNvbnN0IGFsbG93ZWRQYXRocyA9IHJvbGVQYXRoc1t1c2VyUm9sZSBhcyBrZXlvZiB0eXBlb2Ygcm9sZVBhdGhzXTtcclxuICBpZiAoYWxsb3dlZFBhdGhzICYmICFhbGxvd2VkUGF0aHMuaW5jbHVkZXMocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lKSkge1xyXG4gICAgY29uc29sZS5sb2coYFVzZXIgcm9sZSAke3VzZXJSb2xlfSB0cmllZCB0byBhY2Nlc3MgYSByZXN0cmljdGVkIHBhdGgsIHJlZGlyZWN0aW5nIHRvIGRlZmF1bHQgcm9sZSBwYXRoYCk7XHJcbiAgICBjb25zdCBkZWZhdWx0UmVkaXJlY3RVcmwgPSBuZXcgVVJMKGFsbG93ZWRQYXRoc1swXSwgcmVxdWVzdC51cmwpO1xyXG4gICAgY29uc3QgbmV3UmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QoZGVmYXVsdFJlZGlyZWN0VXJsKTtcclxuICAgIG5ld1Jlc3BvbnNlLmhlYWRlcnMuc2V0KCd4LXJlZGlyZWN0LWNvdW50JywgKHJlZGlyZWN0Q291bnQgKyAxKS50b1N0cmluZygpKTtcclxuICAgIHJldHVybiBuZXdSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKCdObyByZWRpcmVjdCBuZWVkZWQsIHByb2NlZWRpbmcgdG8gcmVxdWVzdGVkIHBhZ2UnKTtcclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Um9sZUJhc2VkUmVkaXJlY3Qocm9sZTogc3RyaW5nIHwgdW5kZWZpbmVkLCBiYXNlVXJsOiBzdHJpbmcpOiBVUkwgfCBudWxsIHtcclxuICBzd2l0Y2ggKHJvbGUpIHtcclxuICAgIGNhc2UgJ0FkbWluJzpcclxuICAgICAgcmV0dXJuIG5ldyBVUkwoXCIvYWRtaW4vZGFzaEJvYXJkXCIsIGJhc2VVcmwpO1xyXG4gICAgY2FzZSAnSW5zdHJ1Y3Rvcic6XHJcbiAgICAgIHJldHVybiBuZXcgVVJMKFwiL2luc3RydWN0b3IvZGFzaEJvYXJkXCIsIGJhc2VVcmwpO1xyXG4gICAgY2FzZSAnRXhhbU9mZmljZXInOlxyXG4gICAgICByZXR1cm4gbmV3IFVSTChcIi9leGFtLW9mZmljZXIvcHJvZmlsZVwiLCBiYXNlVXJsKTtcclxuICAgIGNhc2UgJ1RlY2hVbml0JzpcclxuICAgICAgcmV0dXJuIG5ldyBVUkwoXCIvdGVjaC9kYXNoQm9hcmRcIiwgYmFzZVVybCk7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgbWF0Y2hlcjogWycvKCg/IWFwaXxfbmV4dC9zdGF0aWN8X25leHQvaW1hZ2V8ZmF2aWNvbi5pY298YXNzZXRzKS4qKSddLFxyXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJNQVhfUkVESVJFQ1RTIiwicm9sZVBhdGhzIiwiQWRtaW4iLCJJbnN0cnVjdG9yIiwiRXhhbU9mZmljZXIiLCJUZWNoVW5pdCIsIm1pZGRsZXdhcmUiLCJyZXF1ZXN0IiwiY29uc29sZSIsImxvZyIsIm5leHRVcmwiLCJwYXRobmFtZSIsInJlZGlyZWN0Q291bnQiLCJwYXJzZUludCIsImhlYWRlcnMiLCJnZXQiLCJyZWRpcmVjdCIsIlVSTCIsInVybCIsInVzZXJFbWFpbCIsImNvb2tpZXMiLCJ2YWx1ZSIsInVzZXJSb2xlIiwibmV4dCIsInN0YXJ0c1dpdGgiLCJyZWRpcmVjdFVybCIsImdldFJvbGVCYXNlZFJlZGlyZWN0IiwidG9TdHJpbmciLCJuZXdSZXNwb25zZSIsInNldCIsImFsbG93ZWRQYXRocyIsImluY2x1ZGVzIiwiZGVmYXVsdFJlZGlyZWN0VXJsIiwicm9sZSIsImJhc2VVcmwiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});